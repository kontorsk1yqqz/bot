from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackContext, MessageHandler, filters
from telegram.constants import ParseMode  # –û–Ω–æ–≤–ª–µ–Ω–∏–π —ñ–º–ø–æ—Ä—Ç –¥–ª—è ParseMode
import config  # –Ü–º–ø–æ—Ä—Ç—É—î–º–æ —Ñ–∞–π–ª –∑ —Ç–æ–∫–µ–Ω–æ–º

# –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é
main_menu_buttons = [['‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –ø—Ä–æ—Ñ–∫–æ–º—É'], ['üéì –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞']]

# –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é –ø—Ä–æ—Ñ–∫–æ–º—É
info_profkom_buttons = [['üìù –ü—Ä–æ—Ñ—Å–ø—ñ–ª–∫–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è', 'üí≥ ISIC'], ['üìã –ó–∞–ø–∏—Ç–∏', 'üé≠ –ê–∫—Ç–æ—Ä–∏'],
                        ['‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–Ω—ñ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó', 'üè• –°—Ç—Ä–∞—Ö–æ–≤–∫–∞'], ['üîô –ù–∞–∑–∞–¥']]

# –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞
info_student_buttons = [['üìä –†–µ–π—Ç–∏–Ω–≥–æ–≤–∏–π —Å–ø–∏—Å–æ–∫', 'üìö –î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏ –¥–ª—è –∑–¥–∞—á—ñ'],
                        ['üåç –ê–∫–∞–¥–µ–º—ñ—á–Ω–∞ –º–æ–±—ñ–ª—å–Ω—ñ—Å—Ç—å', '‚ö†Ô∏è –û–±–º–µ–∂–µ–Ω–∞ —É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å'],
                        ['üåê –î–ª—è —ñ–Ω–æ–∑–µ–º—Ü—ñ–≤', 'üìñ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏'], ['üîô –ù–∞–∑–∞–¥']]


# –°—Ç–∞—Ä—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è–º —Ç–∞ —Ñ–æ—Ç–æ
async def start(update: Update, context: CallbackContext):
    print("–ö–æ–º–∞–Ω–¥–∞ /start –æ—Ç—Ä–∏–º–∞–Ω–∞")
    user_first_name = update.effective_user.first_name
    reply_markup = ReplyKeyboardMarkup(main_menu_buttons, resize_keyboard=True)

    greeting_message = (
        f"üëã –ü—Ä–∏–≤—ñ—Ç, {user_first_name}!\n"
        "–í—ñ—Ç–∞—î–º–æ –≤ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–º—É Telegram-–±–æ—Ç—ñ –ø—Ä–æ—Ñ–∫–æ–º—É –ù–ù–Ü '–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö –Ω–∞—É–∫ —Ç–∞ —à—Ç—É—á–Ω–æ–≥–æ —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É'!\n\n"
        "–í –Ω–∞—à–æ–º—É –±–æ—Ç—ñ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ:\n\n"
        "1. üì¢ –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤—ñ–¥ –ø—Ä–æ—Ñ–∫–æ–º—É: –î–æ–¥–∞—Ç–∫–æ–≤—ñ –±–∞–ª–∏, —Å—Ç—É–¥–µ–Ω—Ç—Å—å–∫—ñ –∫–∞—Ä—Ç–∏, –≤–∞–∂–ª–∏–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å –ø—Ä–æ—Ñ–∫–æ–º—É —Ç–∞ —ñ–Ω—à–µ.\n\n"
        "2. üìö –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞: –†–µ–π—Ç–∏–Ω–≥–æ–≤—ñ —Å–ø–∏—Å–∫–∏, –≤–∏–±—ñ—Ä–∫–æ–≤—ñ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏, —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –ø–µ—Ä—à–æ–∫—É—Ä—Å–Ω–∏–∫–∞ —Ç–∞ —ñ–Ω—à—ñ –∫–æ—Ä–∏—Å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏."
    )

    # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—ó –∑ –ø—Ä–∏–≤—ñ—Ç–∞–ª—å–Ω–∏–º —Ç–µ–∫—Å—Ç–æ–º
    try:
        with open('–ß–ú.jpg', 'rb') as photo:
            await context.bot.send_photo(chat_id=update.effective_chat.id, photo=photo, caption=greeting_message)
        await update.message.reply_text("–û–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É –∑ –æ–ø—Ü—ñ–π:", reply_markup=reply_markup)
    except FileNotFoundError:
        await update.message.reply_text("–§–æ—Ç–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –∞–ª–µ –±–æ—Ç –ø—Ä–∞—Ü—é—î. –û–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É –∑ –æ–ø—Ü—ñ–π:", reply_markup=reply_markup)


# –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é —Ç–∞ –æ–±—Ä–æ–±–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
async def main_menu(update: Update, context: CallbackContext):
    text = update.message.text
    print(f"–û—Ç—Ä–∏–º–∞–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: {text}")

    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–±–æ—Ä—É –≤ –≥–æ–ª–æ–≤–Ω–æ–º—É –º–µ–Ω—é
    if text == '‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –ø—Ä–æ—Ñ–∫–æ–º—É':
        reply_markup = ReplyKeyboardMarkup(info_profkom_buttons, resize_keyboard=True)
        await update.message.reply_text("üìå –û–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –ø—Ä–æ—Ñ–∫–æ–º—É:", reply_markup=reply_markup)
    elif text == 'üéì –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞':
        reply_markup = ReplyKeyboardMarkup(info_student_buttons, resize_keyboard=True)
        await update.message.reply_text("üìö –û–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤:", reply_markup=reply_markup)
    elif text == 'üîô –ù–∞–∑–∞–¥':
        reply_markup = ReplyKeyboardMarkup(main_menu_buttons, resize_keyboard=True)
        await update.message.reply_text("üîô –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é.", reply_markup=reply_markup)
    else:
        # –Ø–∫—â–æ —Ç–µ–∫—Å—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∂–æ–¥–Ω—ñ–π –∑ –æ–ø—Ü—ñ–π –≤ –º–µ–Ω—é, –æ–±—Ä–æ–±–ª—è—î–º–æ —è–∫ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –≤–∏–±—ñ—Ä
        await handle_response(update, context)


# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
async def handle_response(update: Update, context: CallbackContext):
    text = update.message.text
    print(f"–û–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å: {text}")

    if text == 'üìä –†–µ–π—Ç–∏–Ω–≥–æ–≤–∏–π —Å–ø–∏—Å–æ–∫':
        # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º
        await update.message.reply_text(
            "üìà *–†–µ–π—Ç–∏–Ω–≥–æ–≤–∏–π —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤!*\n\n"
            "üîπ –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ñ —Ä–µ–π—Ç–∏–Ω–≥–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—è–º–∏, "
            "—â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –ø—Ä–æ —Å–≤–æ—ó –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ç–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ.\n\n"
            "üìé [–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —Ç—É—Ç, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ä–µ–π—Ç–∏–Ω–≥](https://karazin.ua/osvita/stipendialne-zabezpechennia/)\n\n",
            parse_mode=ParseMode.MARKDOWN
        )
    elif text in ['üìö –î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏ –¥–ª—è –∑–¥–∞—á—ñ', 'üåç –ê–∫–∞–¥–µ–º—ñ—á–Ω–∞ –º–æ–±—ñ–ª—å–Ω—ñ—Å—Ç—å', '‚ö†Ô∏è –û–±–º–µ–∂–µ–Ω–∞ —É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å',
                  'üåê –î–ª—è —ñ–Ω–æ–∑–µ–º—Ü—ñ–≤', 'üìñ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏']:
        await update.message.reply_text(f"‚úÖ –í–∏ –æ–±—Ä–∞–ª–∏ {text}. –ó–∞—Ä–∞–∑ —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ.")
    elif text in ['üìù –ü—Ä–æ—Ñ—Å–ø—ñ–ª–∫–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è', 'üí≥ ISIC', 'üìã –ó–∞–ø–∏—Ç–∏', 'üé≠ –ê–∫—Ç–æ—Ä–∏',
                  '‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–Ω—ñ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó', 'üè• –°—Ç—Ä–∞—Ö–æ–≤–∫–∞']:
        await update.message.reply_text(f"‚úÖ –í–∏ –æ–±—Ä–∞–ª–∏ {text}. –ó–∞—Ä–∞–∑ —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ.")
    else:
        await update.message.reply_text("‚ùóÔ∏è –û–±–µ—Ä—ñ—Ç—å –¥—ñ–π—Å–Ω–∏–π –ø—É–Ω–∫—Ç –º–µ–Ω—é.")


if __name__ == '__main__':
    # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –±–æ—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç–æ–∫–µ–Ω –∑ config.py
    app = ApplicationBuilder().token(config.BOT_TOKEN).build()

    # –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    app.add_handler(CommandHandler('start', start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, main_menu))

    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω–æ...")
    app.run_polling()
